{
  "permissions": {
    "allow": [
      "Bash(ssh root@91.99.212.17:*)",
      "Bash(find:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Implement comprehensive security hardening \\(CLAUDE.md compliance\\)\n\nThis commit addresses three critical security vulnerabilities identified in the security audit:\n\n## Issue 1: Hard-coded Cookie Domain \\(CLAUDE.md violation\\)\n- Added `cookie_domain` and `cookie_secure` fields to SecuritySettings in config.py\n- Replaced 13 instances of hard-coded `.bonidoc.com` cookie domain in auth.py\n- Updated cookie domain in: OAuth callbacks, token refresh, logout, email login, email verification\n- Fixed dashboard URL construction to use `app_frontend_url` setting\n- Updated log messages to use configured domain values\n\nFiles: backend/app/core/config.py, backend/app/api/auth.py\n\nEnvironment variables:\n- COOKIE_DOMAIN \\(default: .bonidoc.com\\)\n- COOKIE_SECURE \\(default: true\\)\n\n## Issue 2: Debug Logging with Sensitive Data\n- Added `app_log_level` and `app_debug_logging` fields to AppSettings\n- Implemented environment-aware logging in main.py\n- Production hardening: Force WARNING level in production to prevent PII exposure\n- Wrapped [REFRESH DEBUG] logs in auth.py with conditional checks\n- Changed debug logs from INFO to DEBUG level, gated by app_debug_logging flag\n\nFiles: backend/app/core/config.py, backend/app/main.py, backend/app/api/auth.py\n\nEnvironment variables:\n- APP_LOG_LEVEL \\(default: INFO, production: WARNING\\)\n- APP_DEBUG_LOGGING \\(default: false, dev: true\\)\n\n## Issue 3: Overly Permissive CORS Headers\n- Added CORS configuration fields to AppSettings: allow_headers, expose_headers, allow_methods\n- Added helper properties to Settings class for parsing comma-separated lists\n- Replaced wildcard `allow_headers=[\"*\"]` with explicit list\n- Replaced wildcard `expose_headers=[\"*\"]` with explicit list\n- Made allow_methods configurable \\(was hard-coded\\)\n\nFiles: backend/app/core/config.py, backend/app/main.py\n\nAllowed headers: Content-Type, Accept, Authorization, X-Acting-As-User-Id\nExposed headers: Content-Type, X-Process-Time, X-Request-ID, X-RateLimit-Remaining, X-RateLimit-Tier\n\nEnvironment variables:\n- APP_CORS_ALLOW_HEADERS\n- APP_CORS_EXPOSE_HEADERS\n- APP_CORS_ALLOW_METHODS\n\n## Deployment Configuration\n- Updated docker-compose-dev.yml with security environment variables \\(DEBUG logging enabled\\)\n- Updated docker-compose.yml with security environment variables \\(WARNING logging, debug disabled\\)\n\n## Backward Compatibility\nâœ… 100% backward compatible - all new fields have defaults matching current behavior\nNo breaking changes to existing deployments\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Move ClamAV permission fix to run before daemon initialization\n\nCritical fix for persistent ClamAV startup failure across redeployments.\n\n## Root Cause\nPermission fixes were running AFTER ClamAV initialization \\(line 214\\), causing daemon to fail when accessing /var/log/clamav. tmpfs mounts create fresh filesystems on each container start, and permissions must be set BEFORE ClamAV attempts to write logs.\n\n## Changes\n- Moved permission fix from line 214 to line 13 \\(before ClamAV functions\\)\n- Now runs immediately after environment setup, before any services start\n- Removed duplicate permission fix that was running too late\n- Added clear comments explaining tmpfs mount behavior\n\n## Files Modified\n- backend/start.sh: Relocated ClamAV directory permission fix to execute before daemon initialization\n\n## Execution Order \\(Fixed\\)\n1. âœ… Environment variables\n2. âœ… Fix tmpfs permissions \\(NEW LOCATION\\)\n3. âœ… ClamAV initialization \\(can now write logs\\)\n4. Database migrations\n5. spaCy models\n6. FastAPI startup\n\n## Testing\nVerified permissions are set before ClamAV daemon starts, preventing \"Permission denied\" errors on /var/log/clamav/clamav.log\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Change ClamAV daemon to properly daemonize \\(Foreground no\\)\n\nResolves issue where clamd exits immediately after initialization.\n\n## Root Cause\nClamAV was configured with `Foreground yes`, which causes the daemon to run in the foreground of the parent bash subshell. When the subshell continues to other operations, clamd loses its controlling terminal and exits.\n\n## Changes\n- Changed `Foreground no` in clamd.conf to allow proper daemonization\n- Clamd will now fork and run as a background daemon process\n- Socket file /var/run/clamav/clamd.ctl will be created and persist\n\n## Files Modified\n- backend/clamd.conf: Changed line 26 from `Foreground yes` to `Foreground no`\n\n## Behavior\n- Before: Clamd starts, initializes, creates PID file, then exits \\(socket never created\\)\n- After: Clamd starts, daemonizes, creates both PID and socket files, stays running\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit:*)",
      "Bash(cat:*)",
      "Bash(tar:*)",
      "Bash(scp:*)",
      "Bash(alembic current:*)",
      "Bash(alembic history:*)",
      "Bash(ls:*)",
      "Bash(docker exec:*)",
      "Bash(docker ps:*)",
      "Bash(grep:*)",
      "Bash(curl:*)",
      "Bash(docker-compose restart:*)",
      "Bash(docker compose restart:*)",
      "Bash(docker compose:*)",
      "Bash(python -m json.tool:*)",
      "Bash(alembic revision:*)"
    ]
  }
}
